# AES 加密库测试报告

## 📊 测试覆盖范围

### ✅ 功能测试

- **基础加密/解密测试** - GCM、CBC、CTR 三种模式
- **不同密钥长度测试** - AES-128、AES-192、AES-256
- **边界条件测试** - 空数据、单字节、大数据(1MB)
- **错误处理测试** - 无效密钥长度、不支持的加密类型、无效密文
- **数据完整性测试** - 确保加密解密后数据完全一致

### 🔒 安全性测试

- **多线程安全测试** - 16 个协程并发执行 1600 次操作
- **竞争条件检测** - 使用 `-race` 标志验证无数据竞争
- **长时间运行测试** - 10,000 次加密/解密循环
- **内存安全测试** - 10MB 大数据处理

### ⚡ 性能基准测试

#### 加密性能 (Apple M1)

| 模式 | 吞吐量    | 延迟       | 内存分配              |
| ---- | --------- | ---------- | --------------------- |
| GCM  | ~110 MB/s | ~550 ns/op | 880 B/op, 3 allocs/op |
| CBC  | ~128 MB/s | ~475 ns/op | 720 B/op, 3 allocs/op |
| CTR  | ~143 MB/s | ~432 ns/op | 592 B/op, 2 allocs/op |

#### 解密性能 (Apple M1)

| 模式 | 吞吐量    | 延迟       | 内存分配              |
| ---- | --------- | ---------- | --------------------- |
| GCM  | ~232 MB/s | ~263 ns/op | 928 B/op, 3 allocs/op |
| CBC  | ~494 MB/s | ~124 ns/op | 592 B/op, 2 allocs/op |
| CTR  | ~410 MB/s | ~149 ns/op | 656 B/op, 3 allocs/op |

#### 不同数据大小性能

| 数据大小 | 吞吐量     | 延迟        |
| -------- | ---------- | ----------- |
| 16B      | ~21 MB/s   | ~765 ns/op  |
| 64B      | ~75 MB/s   | ~855 ns/op  |
| 256B     | ~301 MB/s  | ~851 ns/op  |
| 1KB      | ~845 MB/s  | ~1.2 μs/op  |
| 4KB      | ~1.66 GB/s | ~2.45 μs/op |
| 16KB     | ~2.16 GB/s | ~7.6 μs/op  |
| 64KB     | ~2.36 GB/s | ~27.7 μs/op |

#### 不同密钥长度性能对比

| 密钥长度 | 吞吐量   | 延迟       |
| -------- | -------- | ---------- |
| AES-128  | ~73 MB/s | ~795 ns/op |
| AES-192  | ~73 MB/s | ~793 ns/op |
| AES-256  | ~69 MB/s | ~836 ns/op |

## 🏆 测试结果总结

### ✅ 所有测试通过

- ✅ 基础功能测试：100% 通过
- ✅ 边界条件测试：100% 通过
- ✅ 多线程安全测试：100% 通过 (无数据竞争)
- ✅ 长时间运行测试：10,000 次操作，768,263 ops/sec
- ✅ 内存测试：10MB 数据处理正常

### 🚀 性能特点

1. **CTR 模式性能最佳** - 加密速度最快，内存分配最少
2. **CBC 模式解密最快** - 解密吞吐量接近 500 MB/s
3. **良好的扩展性** - 数据越大，吞吐量越高
4. **密钥长度影响小** - AES-256 比 AES-128 仅慢 ~5%
5. **并发友好** - 多线程环境下性能稳定

### 🔐 安全保证

- ✅ **线程安全** - 多协程并发访问无数据竞争
- ✅ **内存安全** - 大数据处理无内存泄漏
- ✅ **数据完整性** - 100% 加密解密一致性
- ✅ **错误处理** - 完善的异常情况处理

## 📈 优化建议

1. **选择合适的模式**：

   - 需要认证：使用 GCM 模式
   - 性能优先：使用 CTR 模式
   - 兼容性优先：使用 CBC 模式

2. **数据大小优化**：

   - 小于 1KB 的数据性能相对较低
   - 4KB 以上数据有最佳吞吐量

3. **并发使用**：
   - 库完全线程安全，可以放心在多协程环境使用
   - 创建一个加密器实例，多个协程共享使用

## 🧪 测试环境

- **硬件**：Apple M1
- **操作系统**：macOS (darwin/arm64)
- **Go 版本**：当前版本
- **测试标志**：`-race -v -benchmem`
